---
description:
globs:
alwaysApply: true
---
# API å¼€å‘æ ‡å‡†è§„èŒƒ

## ğŸš€ RESTful API è®¾è®¡è§„èŒƒ

### HTTP æ–¹æ³•ä½¿ç”¨æ ‡å‡†
- `GET` - æŸ¥è¯¢æ•°æ®ï¼Œæ— å‰¯ä½œç”¨
- `POST` - åˆ›å»ºæ–°èµ„æº
- `PUT` - å®Œæ•´æ›´æ–°èµ„æº
- `PATCH` - éƒ¨åˆ†æ›´æ–°èµ„æº
- `DELETE` - åˆ é™¤èµ„æº

### URL è·¯å¾„è®¾è®¡è§„èŒƒ
```typescript
// âœ… æ­£ç¡®ç¤ºä¾‹
GET    /api/users           // è·å–ç”¨æˆ·åˆ—è¡¨
GET    /api/users/:id       // è·å–å•ä¸ªç”¨æˆ·
POST   /api/users           // åˆ›å»ºç”¨æˆ·
PUT    /api/users/:id       // æ›´æ–°ç”¨æˆ·
DELETE /api/users/:id       // åˆ é™¤ç”¨æˆ·

// âŒ é”™è¯¯ç¤ºä¾‹
GET    /api/getUsers        // ä¸è¦åœ¨URLä¸­ä½¿ç”¨åŠ¨è¯
POST   /api/user            // èµ„æºåä½¿ç”¨å¤æ•°å½¢å¼
```

## ğŸ”’ è®¤è¯æˆæƒè§„èŒƒ

### JWT è®¤è¯å®ç°
å‚è€ƒ [src/auth](mdc:src/auth) ç›®å½•ç»“æ„ï¼š
- **ç­–ç•¥**: [src/auth/strategies](mdc:src/auth/strategies) - JWTå’Œæœ¬åœ°è®¤è¯ç­–ç•¥
- **å®ˆå«**: [src/common/guards](mdc:src/common/guards) - è®¤è¯å®ˆå«å®ç°
- **å¸¸é‡**: [src/common/constants.ts](mdc:src/common/constants.ts) - JWTé…ç½®

### å®ˆå«ä½¿ç”¨è§„èŒƒ
```typescript
// Controllerçº§åˆ«å®ˆå«
@UseGuards(JwtAuthGuard)
@Controller('users')
export class UsersController {}

// æ–¹æ³•çº§åˆ«å®ˆå«
@UseGuards(LocalAuthGuard)
@Post('login')
async login() {}
```

## ğŸ“ DTO æ•°æ®éªŒè¯è§„èŒƒ

### DTO è®¾è®¡æ ‡å‡†
å‚è€ƒ [src/user/dto](mdc:src/user/dto) ç›®å½•ï¼š

```typescript
// âœ… æ­£ç¡®çš„DTOè®¾è®¡
export class CreateUserDto {
  @IsEmail()
  @IsNotEmpty()
  email: string;

  @IsString()
  @MinLength(6)
  @MaxLength(20)
  password: string;

  @IsString()
  @IsOptional()
  username?: string;
}
```

### éªŒè¯è§„åˆ™æ ‡å‡†
- ä½¿ç”¨ `class-validator` è£…é¥°å™¨
- å¿…å¡«å­—æ®µä½¿ç”¨ `@IsNotEmpty()`
- å¯é€‰å­—æ®µä½¿ç”¨ `@IsOptional()`
- æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯

## ğŸ›¡ï¸ é”™è¯¯å¤„ç†è§„èŒƒ

### å…¨å±€å¼‚å¸¸è¿‡æ»¤å™¨
å‚è€ƒ [src/common/filters/all.exception.ts](mdc:src/common/filters/all.exception.ts)ï¼š
- ç»Ÿä¸€é”™è¯¯å“åº”æ ¼å¼
- è®°å½•é”™è¯¯æ—¥å¿—
- éšè—æ•æ„Ÿä¿¡æ¯

### å“åº”æ‹¦æˆªå™¨
å‚è€ƒ [src/common/interceptors/response.interceptor.ts](mdc:src/common/interceptors/response.interceptor.ts)ï¼š
- ç»Ÿä¸€æˆåŠŸå“åº”æ ¼å¼
- æ·»åŠ å“åº”æ—¶é—´ç»Ÿè®¡
- æ•°æ®è½¬æ¢å¤„ç†

### æ ‡å‡†å“åº”æ ¼å¼
```typescript
// æˆåŠŸå“åº”
{
  "success": true,
  "data": any,
  "message": string,
  "timestamp": string
}

// é”™è¯¯å“åº”
{
  "success": false,
  "error": {
    "code": number,
    "message": string,
    "details": any
  },
  "timestamp": string
}
```

## ğŸ“Š æ—¥å¿—è®°å½•è§„èŒƒ

### æ—¥å¿—çº§åˆ«ä½¿ç”¨
å‚è€ƒ [src/common/configs/logger.config.ts](mdc:src/common/configs/logger.config.ts)ï¼š
- `error` - ç³»ç»Ÿé”™è¯¯ã€å¼‚å¸¸æƒ…å†µ
- `warn` - è­¦å‘Šä¿¡æ¯ã€éå…³é”®é”™è¯¯
- `info` - å…³é”®ä¸šåŠ¡æ“ä½œ
- `debug` - è°ƒè¯•ä¿¡æ¯ï¼ˆä»…å¼€å‘ç¯å¢ƒï¼‰

### æ—¥å¿—å†…å®¹è§„èŒƒ
```typescript
// âœ… æ­£ç¡®çš„æ—¥å¿—è®°å½•
this.logger.log(`User created successfully: ${userId}`);
this.logger.error(`Database connection failed: ${error.message}`);
this.logger.warn(`Rate limit exceeded for IP: ${clientIp}`);

// âŒ é¿å…è®°å½•æ•æ„Ÿä¿¡æ¯
this.logger.log(`User password: ${password}`); // ä¸è¦è®°å½•å¯†ç 
```

## ğŸ” API æ–‡æ¡£è§„èŒƒ

### Swagger æ³¨è§£ä½¿ç”¨
```typescript
@ApiTags('ç”¨æˆ·ç®¡ç†')
@Controller('users')
export class UsersController {

  @ApiOperation({ summary: 'åˆ›å»ºç”¨æˆ·' })
  @ApiResponse({ status: 201, description: 'ç”¨æˆ·åˆ›å»ºæˆåŠŸ' })
  @ApiResponse({ status: 400, description: 'è¯·æ±‚å‚æ•°é”™è¯¯' })
  @Post()
  async create(@Body() createUserDto: CreateUserDto) {}
}
```

## ğŸ“‹ API å¼€å‘æ£€æŸ¥æ¸…å•

### å¼€å‘å‰å‡†å¤‡
- [ ] ç¡®è®¤APIç«¯ç‚¹è®¾è®¡ç¬¦åˆRESTfulè§„èŒƒ
- [ ] å®šä¹‰è¯·æ±‚/å“åº”DTO
- [ ] ç¡®å®šè®¤è¯æˆæƒéœ€æ±‚
- [ ] è®¾è®¡é”™è¯¯å¤„ç†ç­–ç•¥

### å¼€å‘ä¸­æ£€æŸ¥
- [ ] å®ç°æ•°æ®éªŒè¯
- [ ] æ·»åŠ è®¤è¯å®ˆå«
- [ ] å®ç°ä¸šåŠ¡é€»è¾‘
- [ ] æ·»åŠ é”™è¯¯å¤„ç†
- [ ] è®°å½•æ“ä½œæ—¥å¿—

### å¼€å‘åéªŒè¯
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] æ·»åŠ APIæ–‡æ¡£æ³¨è§£
- [ ] æµ‹è¯•å„ç§è¾¹ç•Œæƒ…å†µ
- [ ] éªŒè¯å®‰å…¨æ€§
- [ ] æ€§èƒ½æµ‹è¯•
